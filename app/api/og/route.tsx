import { ImageResponse } from "next/server";
import React from "react";

export const runtime = "edge";

export const GET = async (request: Request) => {
  try {
    const el = (await generateImage(request)) as React.ReactElement;
    return new ImageResponse(el, {
      width: 1200,
      height: 630,
    });
  } catch (error) {
    return new ImageResponse(defaultImage, {
      width: 1200,
      height: 630,
    });
  }
};

async function generateImage(request: Request) {
  try {
    const { searchParams } = new URL(request.url);

    const title = searchParams.get("title");
    const image = searchParams.get("image");
    const description = searchParams.get("description");

    console.log(`title: ${title}`);
    console.log(`image: ${image}`);
    console.log(`description: ${description}`);

    if (!title && !description) {
      return defaultImage;
    }

    if (title && !description) {
      return justTitle(title);
    }
  } catch (e: any) {
    console.log(`${e.message}`);
    return new Response(`Failed to generate the image`, {
      status: 500,
    });
  }
}

const defaultImage = (
  <div
    style={{
      backgroundColor: "black",
      backgroundSize: "150px 150px",
      height: "100%",
      width: "100%",
      display: "flex",
      textAlign: "center",
      alignItems: "center",
      justifyContent: "center",
      flexDirection: "column",
      flexWrap: "nowrap",
    }}
  >
    <div
      style={{
        display: "flex",
        alignItems: "center",
        justifyContent: "center",
        justifyItems: "center",
      }}
    >
      <svg viewBox="0 0 504 148" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M169.162 1.52588e-05H163.064C163.057 1.52588e-05 163.051 0.00582845 163.051 0.0129994V147.744C163.051 147.751 163.057 147.757 163.064 147.757H169.162C169.169 147.757 169.175 147.751 169.175 147.744V0.0129994C169.175 0.00582845 169.169 1.52588e-05 169.162 1.52588e-05Z"
          fill="#E2E8F0"
        />
        <g clip-path="url(#clip0_1_76)">
          <g clip-path="url(#clip1_1_76)">
            <path
              d="M128.279 60.6967C119.305 55.5159 108.848 54.139 98.8384 56.8216C89.1922 59.4062 81.0815 65.4691 75.8668 73.9368C86.8387 94.2504 79.7034 119.821 59.5848 131.436C52.8509 135.323 45.4847 137.171 38.2164 137.171C37.479 137.171 36.7415 137.139 36.0064 137.099C46.9899 143.629 59.8088 147.389 73.511 147.389C110.633 147.389 141.309 119.868 146.296 84.1199C143.701 74.5809 137.497 66.0198 128.279 60.6967Z"
              fill="#2E6B61"
            />
            <path
              d="M73.511 0.367538C63.7807 0.367538 54.502 2.27532 46.0027 5.70817C39.0285 12.7255 34.7124 22.3882 34.7124 33.0391C34.7124 54.0539 51.5102 71.2076 72.3838 71.8085C78.1457 62.4435 87.114 55.7365 97.7813 52.8777C108.845 49.9139 120.402 51.4343 130.321 57.1612C137.728 61.4388 143.367 67.6126 147.001 74.714C147.002 74.4339 147.022 74.1585 147.022 73.8785C147.022 33.2794 114.111 0.367538 73.511 0.367538Z"
              fill="#2E6B61"
            />
            <path
              d="M57.5416 127.9C75.742 117.391 82.197 94.2655 72.2811 75.889C49.2034 75.2344 30.6284 56.2709 30.6284 33.0391C30.6284 24.478 33.1605 16.4991 37.5023 9.79794C15.1235 22.3998 3.05176e-05 46.3656 3.05176e-05 73.8785C3.05176e-05 97.4102 11.0687 118.341 28.2702 131.796C37.822 134.313 48.3294 133.217 57.5416 127.9Z"
              fill="#2E6B61"
            />
          </g>
        </g>
        <path
          d="M196.304 58V14.3636H204.209V51.3736H223.428V58H196.304ZM237.533 58H229.095L244.457 14.3636H254.216L269.599 58H261.162L249.507 23.3125H249.166L237.533 58ZM237.81 40.8906H260.821V47.2401H237.81V40.8906ZM275.347 58V14.3636H283.252V34.4134H283.784L300.809 14.3636H310.461L293.586 33.9446L310.61 58H301.107L288.088 39.2926L283.252 45.0028V58H275.347ZM315.952 58V14.3636H344.333V20.9901H323.857V32.8366H342.863V39.4631H323.857V51.3736H344.504V58H315.952ZM352.398 58V14.3636H380.778V20.9901H360.303V32.8366H379.308V39.4631H360.303V51.3736H380.949V58H352.398ZM220.018 99.3594C219.82 97.4986 218.982 96.0497 217.504 95.0128C216.041 93.9759 214.138 93.4574 211.794 93.4574C210.146 93.4574 208.733 93.706 207.554 94.2031C206.375 94.7003 205.473 95.375 204.848 96.2273C204.223 97.0795 203.903 98.0526 203.889 99.1463C203.889 100.055 204.095 100.844 204.507 101.511C204.933 102.179 205.509 102.747 206.233 103.216C206.957 103.67 207.76 104.054 208.641 104.366C209.521 104.679 210.409 104.942 211.304 105.155L215.395 106.178C217.043 106.561 218.626 107.08 220.146 107.733C221.68 108.386 223.051 109.21 224.259 110.205C225.48 111.199 226.446 112.399 227.156 113.805C227.866 115.212 228.222 116.859 228.222 118.749C228.222 121.305 227.568 123.557 226.261 125.503C224.955 127.435 223.065 128.947 220.594 130.041C218.136 131.121 215.161 131.661 211.666 131.661C208.271 131.661 205.324 131.135 202.824 130.084C200.338 129.033 198.392 127.499 196.986 125.482C195.594 123.464 194.841 121.007 194.727 118.109H202.504C202.618 119.629 203.087 120.893 203.911 121.902C204.734 122.911 205.807 123.663 207.128 124.161C208.463 124.658 209.955 124.906 211.602 124.906C213.321 124.906 214.827 124.651 216.119 124.139C217.426 123.614 218.449 122.889 219.188 121.966C219.926 121.028 220.303 119.935 220.317 118.685C220.303 117.548 219.969 116.611 219.315 115.872C218.662 115.119 217.746 114.494 216.567 113.997C215.402 113.486 214.038 113.031 212.476 112.634L207.511 111.355C203.918 110.432 201.077 109.033 198.989 107.158C196.915 105.268 195.878 102.761 195.878 99.6364C195.878 97.0653 196.574 94.8139 197.966 92.8821C199.372 90.9503 201.283 89.4517 203.697 88.3864C206.112 87.3068 208.847 86.767 211.901 86.767C214.997 86.767 217.71 87.3068 220.04 88.3864C222.384 89.4517 224.223 90.9361 225.558 92.8395C226.893 94.7287 227.582 96.902 227.625 99.3594H220.018ZM243.174 87.3636V131H235.269V87.3636H243.174ZM257.572 87.3636L268.928 121.71H269.376L280.711 87.3636H289.404L274.021 131H264.262L248.9 87.3636H257.572ZM295.658 131H287.22L302.582 87.3636H312.341L327.724 131H319.287L307.632 96.3125H307.291L295.658 131ZM295.935 113.891H318.946V120.24H295.935V113.891ZM333.472 131V87.3636H349.836C353.188 87.3636 356 87.946 358.273 89.1108C360.56 90.2756 362.286 91.9091 363.451 94.0114C364.63 96.0994 365.219 98.5355 365.219 101.32C365.219 104.118 364.623 106.547 363.429 108.607C362.25 110.652 360.51 112.236 358.209 113.358C355.908 114.466 353.081 115.02 349.729 115.02H338.074V108.457H348.664C350.624 108.457 352.229 108.187 353.479 107.648C354.729 107.094 355.652 106.291 356.249 105.24C356.86 104.175 357.165 102.868 357.165 101.32C357.165 99.7713 356.86 98.4503 356.249 97.3565C355.638 96.2486 354.708 95.4105 353.458 94.8423C352.208 94.2599 350.596 93.9688 348.621 93.9688H341.377V131H333.472ZM356.015 111.227L366.817 131H357.996L347.385 111.227H356.015ZM378.099 131H369.662L385.024 87.3636H394.782L410.166 131H401.728L390.074 96.3125H389.733L378.099 131ZM378.376 113.891H401.387V120.24H378.376V113.891ZM408.477 87.3636H417.405L428.08 106.668H428.506L439.18 87.3636H448.108L432.234 114.722V131H424.351V114.722L408.477 87.3636ZM454.857 131H446.419L461.782 87.3636H471.54L486.924 131H478.486L466.831 96.3125H466.49L454.857 131ZM455.134 113.891H478.145V120.24H455.134V113.891Z"
          fill="white"
        />
        <defs>
          <clipPath id="clip0_1_76">
            <rect
              width="147.022"
              height="147.022"
              fill="white"
              transform="translate(3.05176e-05 0.367569)"
            />
          </clipPath>
          <clipPath id="clip1_1_76">
            <rect
              width="147.022"
              height="147.022"
              fill="white"
              transform="translate(3.05176e-05 0.367569)"
            />
          </clipPath>
        </defs>
      </svg>
    </div>
  </div>
);

const justTitle = (title: string) => (
  <div
    style={{
      backgroundColor: "black",
      backgroundSize: "150px 150px",
      height: "100%",
      width: "100%",
      display: "flex",
      flexDirection: "column",
    }}
  >
    <div
      style={{
        display: "flex",
        padding: "30px",
      }}
    >
      <svg viewBox="0 0 504 148" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M169.162 1.52588e-05H163.064C163.057 1.52588e-05 163.051 0.00582845 163.051 0.0129994V147.744C163.051 147.751 163.057 147.757 163.064 147.757H169.162C169.169 147.757 169.175 147.751 169.175 147.744V0.0129994C169.175 0.00582845 169.169 1.52588e-05 169.162 1.52588e-05Z"
          fill="#E2E8F0"
        />
        <g clip-path="url(#clip0_1_76)">
          <g clip-path="url(#clip1_1_76)">
            <path
              d="M128.279 60.6967C119.305 55.5159 108.848 54.139 98.8384 56.8216C89.1922 59.4062 81.0815 65.4691 75.8668 73.9368C86.8387 94.2504 79.7034 119.821 59.5848 131.436C52.8509 135.323 45.4847 137.171 38.2164 137.171C37.479 137.171 36.7415 137.139 36.0064 137.099C46.9899 143.629 59.8088 147.389 73.511 147.389C110.633 147.389 141.309 119.868 146.296 84.1199C143.701 74.5809 137.497 66.0198 128.279 60.6967Z"
              fill="#2E6B61"
            />
            <path
              d="M73.511 0.367538C63.7807 0.367538 54.502 2.27532 46.0027 5.70817C39.0285 12.7255 34.7124 22.3882 34.7124 33.0391C34.7124 54.0539 51.5102 71.2076 72.3838 71.8085C78.1457 62.4435 87.114 55.7365 97.7813 52.8777C108.845 49.9139 120.402 51.4343 130.321 57.1612C137.728 61.4388 143.367 67.6126 147.001 74.714C147.002 74.4339 147.022 74.1585 147.022 73.8785C147.022 33.2794 114.111 0.367538 73.511 0.367538Z"
              fill="#2E6B61"
            />
            <path
              d="M57.5416 127.9C75.742 117.391 82.197 94.2655 72.2811 75.889C49.2034 75.2344 30.6284 56.2709 30.6284 33.0391C30.6284 24.478 33.1605 16.4991 37.5023 9.79794C15.1235 22.3998 3.05176e-05 46.3656 3.05176e-05 73.8785C3.05176e-05 97.4102 11.0687 118.341 28.2702 131.796C37.822 134.313 48.3294 133.217 57.5416 127.9Z"
              fill="#2E6B61"
            />
          </g>
        </g>
        <path
          d="M196.304 58V14.3636H204.209V51.3736H223.428V58H196.304ZM237.533 58H229.095L244.457 14.3636H254.216L269.599 58H261.162L249.507 23.3125H249.166L237.533 58ZM237.81 40.8906H260.821V47.2401H237.81V40.8906ZM275.347 58V14.3636H283.252V34.4134H283.784L300.809 14.3636H310.461L293.586 33.9446L310.61 58H301.107L288.088 39.2926L283.252 45.0028V58H275.347ZM315.952 58V14.3636H344.333V20.9901H323.857V32.8366H342.863V39.4631H323.857V51.3736H344.504V58H315.952ZM352.398 58V14.3636H380.778V20.9901H360.303V32.8366H379.308V39.4631H360.303V51.3736H380.949V58H352.398ZM220.018 99.3594C219.82 97.4986 218.982 96.0497 217.504 95.0128C216.041 93.9759 214.138 93.4574 211.794 93.4574C210.146 93.4574 208.733 93.706 207.554 94.2031C206.375 94.7003 205.473 95.375 204.848 96.2273C204.223 97.0795 203.903 98.0526 203.889 99.1463C203.889 100.055 204.095 100.844 204.507 101.511C204.933 102.179 205.509 102.747 206.233 103.216C206.957 103.67 207.76 104.054 208.641 104.366C209.521 104.679 210.409 104.942 211.304 105.155L215.395 106.178C217.043 106.561 218.626 107.08 220.146 107.733C221.68 108.386 223.051 109.21 224.259 110.205C225.48 111.199 226.446 112.399 227.156 113.805C227.866 115.212 228.222 116.859 228.222 118.749C228.222 121.305 227.568 123.557 226.261 125.503C224.955 127.435 223.065 128.947 220.594 130.041C218.136 131.121 215.161 131.661 211.666 131.661C208.271 131.661 205.324 131.135 202.824 130.084C200.338 129.033 198.392 127.499 196.986 125.482C195.594 123.464 194.841 121.007 194.727 118.109H202.504C202.618 119.629 203.087 120.893 203.911 121.902C204.734 122.911 205.807 123.663 207.128 124.161C208.463 124.658 209.955 124.906 211.602 124.906C213.321 124.906 214.827 124.651 216.119 124.139C217.426 123.614 218.449 122.889 219.188 121.966C219.926 121.028 220.303 119.935 220.317 118.685C220.303 117.548 219.969 116.611 219.315 115.872C218.662 115.119 217.746 114.494 216.567 113.997C215.402 113.486 214.038 113.031 212.476 112.634L207.511 111.355C203.918 110.432 201.077 109.033 198.989 107.158C196.915 105.268 195.878 102.761 195.878 99.6364C195.878 97.0653 196.574 94.8139 197.966 92.8821C199.372 90.9503 201.283 89.4517 203.697 88.3864C206.112 87.3068 208.847 86.767 211.901 86.767C214.997 86.767 217.71 87.3068 220.04 88.3864C222.384 89.4517 224.223 90.9361 225.558 92.8395C226.893 94.7287 227.582 96.902 227.625 99.3594H220.018ZM243.174 87.3636V131H235.269V87.3636H243.174ZM257.572 87.3636L268.928 121.71H269.376L280.711 87.3636H289.404L274.021 131H264.262L248.9 87.3636H257.572ZM295.658 131H287.22L302.582 87.3636H312.341L327.724 131H319.287L307.632 96.3125H307.291L295.658 131ZM295.935 113.891H318.946V120.24H295.935V113.891ZM333.472 131V87.3636H349.836C353.188 87.3636 356 87.946 358.273 89.1108C360.56 90.2756 362.286 91.9091 363.451 94.0114C364.63 96.0994 365.219 98.5355 365.219 101.32C365.219 104.118 364.623 106.547 363.429 108.607C362.25 110.652 360.51 112.236 358.209 113.358C355.908 114.466 353.081 115.02 349.729 115.02H338.074V108.457H348.664C350.624 108.457 352.229 108.187 353.479 107.648C354.729 107.094 355.652 106.291 356.249 105.24C356.86 104.175 357.165 102.868 357.165 101.32C357.165 99.7713 356.86 98.4503 356.249 97.3565C355.638 96.2486 354.708 95.4105 353.458 94.8423C352.208 94.2599 350.596 93.9688 348.621 93.9688H341.377V131H333.472ZM356.015 111.227L366.817 131H357.996L347.385 111.227H356.015ZM378.099 131H369.662L385.024 87.3636H394.782L410.166 131H401.728L390.074 96.3125H389.733L378.099 131ZM378.376 113.891H401.387V120.24H378.376V113.891ZM408.477 87.3636H417.405L428.08 106.668H428.506L439.18 87.3636H448.108L432.234 114.722V131H424.351V114.722L408.477 87.3636ZM454.857 131H446.419L461.782 87.3636H471.54L486.924 131H478.486L466.831 96.3125H466.49L454.857 131ZM455.134 113.891H478.145V120.24H455.134V113.891Z"
          fill="white"
        />
        <defs>
          <clipPath id="clip0_1_76">
            <rect
              width="147.022"
              height="147.022"
              fill="white"
              transform="translate(3.05176e-05 0.367569)"
            />
          </clipPath>
          <clipPath id="clip1_1_76">
            <rect
              width="147.022"
              height="147.022"
              fill="white"
              transform="translate(3.05176e-05 0.367569)"
            />
          </clipPath>
        </defs>
      </svg>
    </div>
    <div
      style={{
        fontSize: 60,
        fontStyle: "normal",
        letterSpacing: "-0.025em",
        color: "white",
        marginTop: 30,
        lineHeight: 1.4,
        textAlign: "center",
        width: "100%",
        display: "flex",
        alignItems: "center",
        justifyContent: "center",
      }}
    >
      {title}
    </div>
  </div>
);
